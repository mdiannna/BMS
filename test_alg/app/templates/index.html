{% extends 'bootstrap/base.html' %}
{% block metas %}
<!-- <meta charset="utf-8"> -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
{% endblock metas %}
{% block styles %}
{{super()}}
<!-- <link rel="stylesheet" href="{{url_for('.static', filename='signup.css')}}"> -->
{% endblock %}

{% block head %}
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>

<title>Test algorithm</title>
<style type="text/css">
	form{
		margin-left:10px;
	}
	.same_line{
		display: inline-block;
	}
</style>
{% endblock %}

{% block content %}

<form method="post" class ="form-inline animated flipInX" align="center">
	{{form.csrf_token}}
	<H1>	Test BMS algorithm</H1>
	<div class="row" style="margin-top:10px; margin-bottom:10px;">
		<div class="form-group input">
			{{form.nr_tests.label}}
			{{form.nr_tests(class_='form-control')}}
			<!-- {{form.submit(class_='form-control btn btn-default', onclick="test()") }} -->
			{{form.submit(class_='form-control btn btn-default btn-warning') }}
			<!-- <button onclick="test()">OK</button> -->
		</div>
	</div>
</form>

<table id = "myTable" border="2px" align="center">
	<th>Nr.</th>
	<th>Algorithm</th>
	<th>Message length</th>
	<th>Key length</th>
	<th>Encryption time(ms)</th>
	<th>Decryption time(ms)</th>

	{% for i in range(nr_of_tests) %}
		<tr>
			<td>{{i+1}}</td>
			<td>{{algorithm}}</td>
			<td>{{msg_len}}</td>
			<td>{{key_len}}</td>
			<td>{{enc_time[i]}}</td>
			<td>{{dec_time[i]}}</td>
		</tr>
	{% endfor %}
	
</table>

<hr>
<div align="center">
	<label id ="canvas_label" for = "c" style="visibility: hidden;">Encryption time<br/>
	<canvas id="c" width="1000" height="300"></canvas>    
</label>

</div>
<br>
<br>

	

{% if exception%}
	<script type="text/javascript">
		alert("Error! Please specify nr. of tests");
	</script>
{% endif %}


  <script type="text/javascript">

  
  	function addMedianToTable()
  	{
  		var table = document.getElementById("myTable");
 		var row = table.insertRow();
 
 		var cell = row.insertCell(0);
		var algo_cell = row.insertCell(1);
		var msg_len_cell = row.insertCell(2);
		var key_len_cell = row.insertCell(3);
		var enc_time_median_cell = row.insertCell(4);
		var dec_time_median_cell = row.insertCell(5);
 
		algo_cell.innerHTML = "Median";
		// msg_len_cell.innerHTML = "{{msg_len}}";
		// key_len_cell.innerHTML = "{{key_len}}";
		enc_time_median_cell.innerHTML = "{{enc_time_median[0]}}";
		dec_time_median_cell.innerHTML = "Not computed";
		
		row.setAttribute("style", "font-weight: bold;");
  	}

  	function addMeanToTable()
  	{
  		var table = document.getElementById("myTable");
 		var row = table.insertRow();
 		
 		var cell = row.insertCell(0);
		var algo_cell = row.insertCell(1);
		var msg_len_cell = row.insertCell(2);
		var key_len_cell = row.insertCell(3);
		var enc_time_mean_cell = row.insertCell(4);
		var dec_time_mean_cell = row.insertCell(5);
 
		algo_cell.innerHTML = "Mean";
		// msg_len_cell.innerHTML = "{{msg_len}}";
		// key_len_cell.innerHTML = "{{key_len}}";
		enc_time_mean_cell.innerHTML = "{{enc_time_avg[0]}}";
		dec_time_mean_cell.innerHTML = "Not computed";

		// row.id="mean_row";
		// document.getElementById("mean_cell").setAttribute("style", "font-weight: bold;");
		row.setAttribute("style", "font-weight: bold;");
  		
  	}

  	if({{enc_time}}.length>0)
  	{
  		addMedianToTable();
  	  	addMeanToTable();
  	}

  	if("{{show_chart}}" == "True"){
  		generateChart();
  	};


	function generateChart()
	{

		document.getElementById("canvas_label").setAttribute("style", "visibility: visible;");
	    
	    var labels_data = [];
	        
	    for (var i = 0; i<{{nr_of_tests}}; i++) 
	    {
	        labels_data.push((i+1).toString())
	    };

	    var ctx = document.getElementById("c").getContext("2d");
	    var data = {

	      labels: labels_data,
	      datasets: [{
	        label: "Encryption time",
	        fillColor: "#E91E63",
	        strokeColor: "rgba(220,220,220,1)",
	        pointColor: "rgba(220,220,220,1)",
	        pointStrokeColor: "#fff",
	        pointHighlightFill: "#fff",
	        pointHighlightStroke: "rgba(220,220,220,1)",
	        data: {{enc_time}}
	      }
	      , 
	      {
	        label: "Median",
	        fillColor: "rgba(151,187,205,0.2)",
	        strokeColor: "red",
	        pointColor: "red",
	        pointStrokeColor: "#fff",
	        pointHighlightFill: "#fff",
	        pointHighlightStroke: "rgba(151,187,205,1)",
	        data: {{enc_time_median}}
	      }
	      , 
	      {
	        label: "Mean",
	        fillColor: "rgba(151,17,205,0.2)",
	        strokeColor: "orange",
	        pointColor: "orange",
	        pointStrokeColor: "#fff",
	        pointHighlightFill: "#fff",
	        pointHighlightStroke: "rgba(151,187,205,1)",
	        data: {{enc_time_avg}}
	      }
	      ]
	    };

	    
	    var options = {      
	    	scaleLabel : "<%= value + ' ms ' %>"
		};
	   
	    var MyNewChart = new Chart(ctx).Line(data, options);
   };
  </script>




{% endblock %}



